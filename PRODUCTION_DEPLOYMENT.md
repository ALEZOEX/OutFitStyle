

# üì¶ –ì–∞–π–¥ –ø–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–¥–µ–ø–ª–æ—é OutfitStyle

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å OutfitStyle –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (prod)

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

1. **Go API‚Äë—Å–µ—Ä–≤–µ—Ä** ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π backend.
2. **ML‚Äë—Å–µ—Ä–≤–∏—Å** ‚Äì Python/Flask ML‚Äë–º–æ–¥—É–ª—å.
3. **PostgreSQL** ‚Äì –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
4. **Redis** ‚Äì –∫—ç—à –∏ —Å–µ—Å—Å–∏–∏/–ª–∏–º–∏—Ç—ã.
5. **Nginx** ‚Äì reverse proxy + SSL‚Äë—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS).

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —É–ø–∞–∫–æ–≤–∞–Ω—ã –≤ Docker‚Äë–æ–±—Ä–∞–∑—ã –∏ —Å—Ç–∞—Ä—Ç—É—é—Ç —á–µ—Ä–µ–∑ `docker-compose` –∏–ª–∏ Kubernetes.

---

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω—É–∂–Ω–æ:

- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Docker –∏ Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ;
- –¥–æ–º–µ–Ω –¥–ª—è HTTPS (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω SSL);
- –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î,
    - —Å–µ–∫—Ä–µ—Ç—ã JWT,
    - –∫–ª—é—á–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API (OpenWeatherMap –∏ —Ç.–ø.);
- —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SSL‚Äë—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ HTTPS —á–µ—Ä–µ–∑ Nginx).

---

## –®–∞–≥ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞—ë–º `.env.prod`:

```bash
cp infrastructure/docker-compose/.env.example infrastructure/docker-compose/.env.prod
```

–ü—Ä–∞–≤–∏–º `infrastructure/docker-compose/.env.prod`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_USER=prod_db_user
DB_PASSWORD=prod_db_password
DB_NAME=outfitstyle

# JWT
JWT_SECRET=prod_secure_jwt_secret

# –ü–æ–≥–æ–¥–∞
WEATHER_API_KEY=your_openweathermap_api_key

# CORS
CORS_ALLOWED_ORIGINS=https://yourdomain.com

# –û–±—â–∏–π —Ä–µ–∂–∏–º
ENVIRONMENT=production
```

---

## –®–∞–≥ 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω‚Äë–æ–±—Ä–∞–∑–æ–≤

```bash
# Go API
cd server
docker build -t outfitstyle/api:latest -f Dockerfile.prod .

# ML-—Å–µ—Ä–≤–∏—Å
cd ../server/ml-service
docker build -t outfitstyle/ml-service:latest -f Dockerfile.prod .

# Marketplace-—Å–µ—Ä–≤–∏—Å (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
cd ../marketplace-service
docker build -t outfitstyle/marketplace-service:latest -f Dockerfile.prod .
```

(–¢–µ–≥–∏ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ —Å–≤–æ–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏.)

---

## –®–∞–≥ 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose.prod.yml

```bash
cd infrastructure/docker-compose
docker compose -f docker-compose.prod.yml up -d
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:

```bash
docker compose -f docker-compose.prod.yml ps
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ health‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:

```bash
curl http://yourdomain.com/health           # –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Nginx –Ω–∞ API
curl http://yourdomain.com/api/ml/health    # –µ—Å–ª–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç–µ ML –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–æ–¥-–ø—É—Ç—å
```

---

## –®–∞–≥ 4. –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
docker compose -f docker-compose.prod.yml logs -f
docker compose -f docker-compose.prod.yml logs -f api
docker compose -f docker-compose.prod.yml logs -f ml-service
```

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- `/metrics` –Ω–∞ API‚Äë—Å–µ—Ä–≤–µ—Ä–µ ‚Äì –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus.
- Nginx‚Äë–ª–æ–≥–∏ ‚Äì –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞.

---

## –ß–µ–∫‚Äë–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

‚úÖ **ML‚Äë—Å–µ—Ä–≤–∏—Å**

- [x] `/health` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.
- [x] –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω—ã (–ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª/volume.
- [x] –ü—Ä–æ–¥–∞–∫—à–µ–Ω‚ÄëDockerfile.

‚úÖ **Go API**

- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏.
- [x] Graceful shutdown (–∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Ç–∞–π–º–∞—É—Ç–æ–º, –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π).
- [x] Rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware + Nginx.
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ origin‚Äô—ã.

‚úÖ **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

- [x] `docker-compose.prod.yml` c –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏ –∏ volume‚Äô–∞–º–∏.
- [x] Nginx‚Äë–∫–æ–Ω—Ñ–∏–≥ —Å SSL (Let‚Äôs Encrypt/Certbot –∏–ª–∏ –≤–∞—à–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã).
- [x] Health‚Äë—á–µ–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- [x] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤.

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### Health‚Äë—á–µ–∫–∏

- API‚Äë—Å–µ—Ä–≤–µ—Ä: `GET /health`
- ML‚Äë—Å–µ—Ä–≤–∏—Å: `GET /health`
- (Nginx —á–∞—Å—Ç–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞—Ä—É–∂—É –¥–ª—è —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.)

### –ú–µ—Ç—Ä–∏–∫–∏

- API:
    - `GET /metrics` ‚Äì Prometheus‚Äë—Ñ–æ—Ä–º–∞—Ç
- ML‚Äë—Å–µ—Ä–≤–∏—Å:
    - –ª–∏–±–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π `/metrics`,
    - –ª–∏–±–æ —ç–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤/–º–µ—Ç—Ä–∏–∫ –≤ –æ–±—â—É—é —Å–∏—Å—Ç–µ–º—É.

### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

–†–µ–≥—É–ª—è—Ä–Ω–æ –±—ç–∫–∞–ø–∏–º:

- –ë–î `PostgreSQL`:

  ```bash
  docker compose -f docker-compose.prod.yml exec postgres \
    pg_dump -U "$DB_USER" "$DB_NAME" > backup_$(date +%F).sql
  ```

- –ú–æ–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (`server/ml-service/models/*`).
- –í–∞–∂–Ω—ã–µ –ª–æ–≥–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏/–æ—Ç–ª–∞–¥–∫–∏).

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:

- –≤ Docker Swarm / Kubernetes:
    - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º `replicas` API, ML‚Äë—Å–µ—Ä–≤–∏—Å–∞;
    - —Å—Ç–∞–≤–∏–º –æ–±—â–∏–π Redis/–ë–î;
    - –∏—Å–ø–æ–ª—å–∑—É–µ–º Ingress / LoadBalancer.

–î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ docker‚Äëcompose:

```yaml
services:
  api:
    deploy:
      replicas: 3
```

(–≤ —á–∏—Å—Ç–æ–º docker‚Äëcompose `deploy`‚Äë—Å–µ–∫—Ü–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è; –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ Swarm/K8s.)

---

## –ò—Ç–æ–≥

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞:
    - Go API,
    - ML‚Äë—Å–µ—Ä–≤–∏—Å,
    - marketplace‚Äë—Å–µ—Ä–≤–∏—Å (–∫–∞—Ç–∞–ª–æ–≥),
    - PostgreSQL,
    - Redis,
    - Nginx.
- –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç—å —É–¥–æ–±–Ω—ã–π `docker compose up --build`.
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äì `docker-compose.prod.yml` + –ø–æ–Ω—è—Ç–Ω—ã–π –Ω–∞–±–æ—Ä ENV.
- ML‚Äë—Å–µ—Ä–≤–∏—Å –∏ API –≥–æ—Ç–æ–≤—ã –∫ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–º—É —É–ª—É—á—à–µ–Ω–∏—é (–ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ª–æ–≥–∞—Ö, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∏—á–µ–π –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏).

–î–∞–ª—å—à–µ –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏ (features, loss, A/B‚Äë—Ç–µ—Å—Ç—ã), –Ω–µ —Ç—Ä–æ–≥–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–∫–µ–ª–µ—Ç.