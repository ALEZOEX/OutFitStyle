# TODO: Исправить функциональность профиля и автозапуск миграций

## Задача 1: Сделать персонализацию в профиле рабочей

### Текущее состояние
- Кнопки "гендер" и "стиль" в профиле - просто UI заглушки
- Не происходит сохранение данных в БД
- Не происходит использование этих данных в рекомендательной системе

### Что нужно сделать

#### 1.1 Обновить модель пользователя
- Добавить поля gender_preference и style_preference в таблицу users
- Обновить модель домена пользователя

#### 1.2 Создать API endpoint для обновления профиля
- PUT /api/v1/users/profile - обновление предпочтений
- Валидация входных данных
- Обновление БД

#### 1.3 Обновить Planner
- Использовать user preferences при генерации плана
- Учитывать gender_preference при фильтрации кандидатов
- Учитывать style_preference при ранжировании

#### 1.4 Обновить интерфейс профиля
- Сделать кнопки интерактивными
- Добавить сохранение изменений при нажатии
- Добавить индикатор загрузки при сохранении

### Тесты
- Unit-тесты для обновления профиля
- E2E-тест: изменение предпочтений → получение других рекомендаций

---

## Задача 2: Автоматическое применение миграций при запуске

### Текущее состояние
- Миграции нужно накатывать вручную через psql
- Нет автоматического процесса миграции при деплое

### Что нужно сделать

#### 2.1 Создать миграционный скрипт
- Файл: server/scripts/migrate.py или server/cmd/migrate/main.go
- Подключение к БД
- Поиск всех .sql файлов в папке migrations/
- Сортировка по имени (лексикографически)
- Применение в правильном порядке

#### 2.2 Добавить миграции в Docker
- Обновить Dockerfile для Go-сервиса
- Запуск миграций перед запуском основного сервиса
- Обработка ошибок миграции (сервис не запускается при ошибках миграции)

#### 2.3 Создать таблицу schema_migrations
- Отслеживание примененных миграций
- Избегание повторного применения
- Поддержка rollback (опционально)

### Тесты
- Проверка применения миграции в clean database
- Проверка, что миграции не применяются дважды
- Проверка запуска в Docker

---

## Задача 3: Обновить CI/CD pipeline

### Что нужно сделать
- Добавить шаг миграции в GitHub Actions
- Применение миграций в тестовой БД в CI
- Проверка совместимости схемы с кодом